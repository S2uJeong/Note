# 그림으로 공부하는 마이크로 서비스 구조
- 부제 : DX의 애플리케이션 현대화를 추진하기 위해 필요한 클라우드 네이티브 컴퓨팅의 기술 요소 
## 목차
1. 클라우드 네이티브 컴퓨팅과 마이크로 서비스 
2. 마이크로서비스 아키텍처의 기본 
   - 서비스 구조, 레이어 아키텍처, 헥사거널 아키텍처, 데이터베이스 접근, 트랜잭션 처리, 데이터베이스 간 동기화, 데이터 결합, 서비스 간 연계, 서비스화 진행 방법 
3. 마이크로서비스 패턴
   - 데이터 관리 / 트랜잭셔널 메시징 / 서비스 검색 / 외부 API / 통신 / 배포 / 관찰 가능성 / 리팩터링 패턴
4. 컨테이너, 쿠버네티스, 서버리스
5. 서비스 메시
6. 마이크로서비스의 개발과 운영
---
## 1장. 클라우드 네이티브 컴퓨팅와 MSA
### 클라우드 네이티브 컴퓨팅
- 구성 기술 요소 : 컨테이너, 컨테이너 오케스트레이션, 마이크로 서비스
  - 컨테이너 오케스트레이션 : 컨테이너 클러스터 관리 및 운영을 중심으로, 컨테이너 클러스터 배포, 이름 해결, 라우팅, 서비스 검색, 부하분산, 확장, 장애 시 자가복구 기능 제공 
- 마이크로 서비스 방식으로 애플리케이션을 개발하고, 그 애플리케이션을 컨테이너에 배포해서 실행한다. 그리고 오케스트레이션 기능을 통해 컨테이너화된 애플리케이션을 운영한다.
- 목적 
  - 확장 가능한 애플리케이션을 구축/운영하는 것
  - IT 시스템에 최소한의 인력으로 자주, 그리고 계획한 만큼 임팩트 있는 변경을 추가하는 것 
  - 비즈니스적으론 대규모 시스템을 신속하게 구축해서 시장이 필요로 하는 것을 유연하게 제공하는 것
- 참고 url
  - 클라우드 네이티브 컴퓨팅 관련 기술 정리/분류 : https://landscape.cncf.io
  - 클라우드 네이티브 트레일 맵 : https://github.com/cncf/trailmap

### 마이크로 서비스
- MSA를 사용해 애플리케이션을 독립된 소프트웨어 컴포넌트, 즉 서비스로 분할 하는 것
- 하나의 요청(Request)를 처리하기 위해 각 서비스는 REST나 메시징으로 통신하는 분산 컴퓨팅 환경 구성
- 특징
  ```
  1. 서비스를 사용한 컴포넌트화
  2. 비즈니스 기능을 기준으로 한 팀 편성
  3. 프로젝트가 아닌 제품을 파악해서 개발 및 운영
  4. 지능적인 엔드포인트와 단순한 파이프
  5. 비중앙집권적인 언어와 툴 선택
  6. 비중앙집권적인 데이터 관리
  7. 인프라의 자동화
  8. 장애와 오류를 전제로 한 설계
  9. 선진적인 설계
  ```
- 장점
  ```
  - 작은 단위의 애플리케이션 릴리스
  - 빠르고 유연한 애플리케이션 변경 및 유지/관리
  - 작은 단이의 확장
  - 장애 영향을 최소화
  ```
- 운영 시 고려사항
  - 서비스 간 통신 지연
  - 분산 배치된 데이터의 동기화
  - 분산 컴퓨팅 환경의 운영 및 감시 비용
  - 시스템 전체 설계의 일관성 및 통일성
  - 서비스 모델링 기법의 학습 난이도 

## 2장. 마이크로서비스 아키텍처의 기본
### 헥사거널 아키텍처
- 불특정한 데이터 입출력에 대응할 수 있도록 확장성을 가짐
- 외부 입출력과 도메인 사이에 포트,어댑터를 두어 가능한 구조


### 데이터 결합 
- CQRS; 명령 질의 책임 분리 
  - 데이터 접근 처리를 갱신형 처리(데이터 삽입/변경/삭제)와 참조형 처리(데이터 검색/취득)으로 구분하고
  - 각각을 구현하기 위해 독립된 서비스 컴포넌트와 데이터 저장소를 두는 디자인 패턴 
  - 일반적으로 참조형 처리는 요청량이 방대해서 빠른 응답이 중요하고, 갱신형 처리는 요청량이 그렇게 많지 않지만 안전하고 확실한 트랜잭션 완료가 요구된다.
- 이벤트 소싱
  - 갱신형 저장소와 참조형 저장소를 동기화해 주는 구조 
  - 필요에 따라 검색용 데이터 스토어를 준비하고 메시징 기반 미들웨어(MOM)의 비동기 메시징을 사용해 이벤트 소스와 검색용 데이터 저장소를 동기화 한다. 

## 3장. 마이크로서비스 패턴 
### 데이터 관리 패턴
- 데이터베이스 동기화 패턴
  - 코레오그래피
    - DB에 접속하는 서비스가 각각 메시징 제품을 통해서 데이터를 동기화하는 방법
    - 각 서비스 내부에는 비즈니스 로직이나 보상 트랜잭션 로직에 추가로 사가를 성립시키기 위한 데어 로직도 구현해야 한다. 