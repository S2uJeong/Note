# 서버의 기초
## 서버 
- 파일 서버
  - LAN이나 WAN 등의 네트워크상에서 다른 컴퓨터와 파일을 공유하거나, 데이터를 전달 받기 위해 사용하는 서버
- NAS
  - 파일 서버와 같은 역할을 하는 기기로 Network Attached Storage 라고 한다.
  - 파일 서버의 기능에 특화된 어플라이언스 서버이다.
  - OS나 소프트웨어 설치 필요 없이 간단하게 파일 공유 환경을 구축할 수 있으며
  - 독자적인 캐시나 원격지 백업등의 기능도 제공한다. 
- 메일 서버 : 송신/수신 각각
  - SMTP 
    - 송신 하는 측의 프로토콜
    - 보안이 포함된 SMTPS를 사용하는 추세 
  - POP; Post Office Protocol, IMAP; Interner Message Protocol
    - 수신 측의 프로토콜
  - 메일 구조에서 마지막 부분만 다른 프로토콜을 사용하는 이유
    - SMTP는 송신하고자 할 때 송신하는 푸시 타입 프로토콜이고
    - 받는 PC가 항상 켜져 있을 것이라 단언할 수 없기 때문에 켜져 있는 상태에서 원할 때만 메일 박스의 메일을 다운로드 할 수 있도록
    - 수신측엔 풀 타입 프로토콜을 사용 
    - 메일 소프트웨어는 수동 또는 정기적으로 POP/IMAP 서버에 메일을 달라고 요청한다. 
    - POP/IMAP 서버는 메일 소프트웨어 받은 사용자명과 비밀번호를 인증하고, 인증에 성공하면 메일 박스로부터 메일을 꺼내 전송한다. 
  
- 웹의 3계층 모델
  - 웹 서비스 시스템은 웹 / 애플리케이션 / 데이터 베이스 서버로 구성됨
  - 정적 페이지는 웹 서버에서 바로 응답하고
  - 동적 페이지는 모든 서버를 거친뒤 응답된다.
  - 애플리케이션 서버의 역할
    - 웹 서버와 DB 서버의 중개역할을 하며 프로그램을 실행한다.
    - 데이터베이스 접속 기능
      - 데이터 읽고 쓰기
      - 접속을 유지함으로써 접속 처리 부하 줄임
    - 트랜잭션 관리 기능
      - 3개의 서버 (웹/애플리케이션/DB)가 연동하는 처리에 불일치가 생기지 않도록 관리 

- 암호화 기술
  - 암호화키, 복호화 키 둘 다 필요하다. 이 키를 갖는 방법에 따라 공통키 / 공개키 암호화 방식으로 나뉜다.
  - 공통키 암호화
    - 암호화 키 = 복호화 키
    - 클라이언트와 서버에 같은 키를 공유하고, 클라가 암호화 키로 암호화하고
    - 서버가 암호화 키와 완전히 같은 복호화 키로 복호화 한다.
    - 구조 단순해 처리 부하가 없으나 키를 공유하는 배송 방법을 고려해야 함
  - 공개키 암호화
    - 암호화 키 != 복호화 키
    - 서버가 암호화와 복호화 키 한 쌍을 만든다. 이 한 쌍은 수학적인 관계에서 성립하므로
    - 해당 암호화 키로 암호화 한 것은 해당 복호화 키로만 풀 수 있음
    - 서버는 암호화 키를 공개키로 인터넷상에 공개하고 복호화 키를 비밀키로 서버에 저장한다
    - 클라는 공개된 공개키를 사용해 데이터를 암호화해서 서버에 보내고 서버는 비밀키를 통해 복호화 한다.
  - SSL/TLS는 두가지 방법을 혼용해서 쓴다.

- HTTPS
  - SSL/TLS는 암호화, 해시화, 디지털 인증서를 조합해 보안한다. 
  - 암호화
    - 정해진 규칙에 따라 데이터를 변환하는 기술
    - 도청을 예방
    - 흐름
      1. 서버는 클라가 접속하면 공개키와 디지털 서명과 함께 디지털 인증서를 반환 
      2. 클라는 디지털 서명을 보고 인증서 확인, 올바르다면 공통키의 재료를 공개키로 암호화해서 서버로 보냄
      3. 서버는 받은 데이터를 비밀키로 복호화하고 공통키의 재료를 추출  (1~3을 SSL 핸드셰이크 라고 부름 )
      4. 클라와 서버는 각각 공통키의 재료로부터 공통키를 만들고 그것을 사용해 암호화 통신을 수행
  - 해시화
    - 데이터로부터 고정 길이의 데이터(해시값)을 추출하는 계산 
    - 데이터를 전달할 때 송신 측과 수신 측의 해시값을 계산하고, 그 값이 같으면 데이터가 변하지 않았음을 알 수 있음
    - 변조를 예방 
  - 디지털 인증서
    - 해당 클라이언트가 진짜인지 증명
    - 위장 예방 
    - 흐름
      1. 관리자가 서버 소프트웨어에서 비밀/공개키를 만들고, 공개키를 CSR(Certificate Signing Request; 인증서 서명 요청)으로 인증국(CA)라는 제 3자 기관에 제출
      2. 비밀키는 보관
      3. 인증국은 신용 판단 후에 CSR에 보증 부여하고, 디지털 인증서로 관리자에게 반환
      4. 관리자는 인증국에서 받은 디지털 인증서를 서버에 설치 

## 장애 대응
- 클러스터 
  - 여러 대의 서버를 네트워크에 연결하고 전체가 한 대의 서버처럼 보이도록 하는 기술
  - 한 대의 서버가 고장 나도 다른 서버로 처리를 계속할 수 있다. 
  - 구성에 따른 종류
    - 공유 스토리지 구성
      - NAS와 같은 공유 스토리지를 통해 여러 서버에서 공유하는 스토리지 제공하여 데이터 정합성 맞춤
    - 데이터 복제 구성 
      - 스토리지를 완전 동일한 내용을 복제해 데이터 정합성 확보
      - 소대용량의 데이터를 다루는 서버에는 적합치 않음 

- 서버 부하 분산 기술
  - DNS 라운드 로빈
    - DNS를 사용해 부하 분산. DNS 서버에서 하나의 도메인명에 여러 IP주소를 등록
    - 결과적으로 커넥션이 나누어짐. 
    - 저렴하나 서버 장애에 관계 없이 통신이 분산되거나 한쪽으로 치우치는 문제 있음
  - 서버 타입
    - 서버에 설치한 소프트웨어를 사용해 부하를 분산 
  - 어플라이언스 서버 타입 
    - 부하 분산 장치라는 서버 부하 분산 전용 어플라이언스 서브를 사용

- 웹 애플리케이션 방화벽; WAF
  - 포트 번호뿐만 아니라 HTTP로 전달되는 데이터 모두를 애플리케이션 레벨에서 감시해 통신을 제어하자.
  - 서버 소프트웨어로 도입하는 호스트 타입
  - 클라우드 SaaS로 제공되는 SaaS 타입
  - 어플라이언스 서버로 도입하는 어플라이언스 서버 타입
  - 웹 서비스에 대한 대표적 공격 방법
    - SQL 주입
    - 크로스 사이트 스크립팅
    - 크로스 사이트 요청 위조 (CSRF)